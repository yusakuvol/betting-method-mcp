# マーチンゲール法（Martingale Method）

## 概要

マーチンゲール法は、最も有名なベッティング戦略の一つで、負けるたびに賭け金を倍にしていく方法です。理論上は、いつか必ず勝つことで、それまでの損失をすべて回収し、初期賭け金分の利益を得られます。

## 仕組み

### 基本ルール

1. **初期賭け金を設定**: 例えば10ドル
2. **勝った場合**: 賭け金を初期値にリセット（10ドルに戻す）
3. **負けた場合**: 賭け金を2倍にする（10 → 20 → 40 → 80...）
4. 勝つまで倍賭けを続ける

### 計算式

```
現在の賭け金 = 初期賭け金 × 2^(連敗回数)
```

### 例

| ラウンド | 結果 | 賭け金 | 累積損益 |
|---------|------|--------|---------|
| 1       | 負け | 10     | -10     |
| 2       | 負け | 20     | -30     |
| 3       | 負け | 40     | -70     |
| 4       | 勝ち | 80     | +10     |
| 5       | 負け | 10     | 0       |
| 6       | 勝ち | 20     | +10     |

## パラメータ

### 必須パラメータ

- **baseUnit** (基本賭け金): 初期の賭け金額
  - 例: `10`, `100`, `1000`

### オプションパラメータ

- **maxBet** (最大賭け金): 賭け金の上限
  - デフォルト: `baseUnit × 1024` (10連敗分)
  - 無制限にするには `Infinity` を指定

- **maxLossStreak** (最大連敗数): セッションを強制終了する連敗数
  - デフォルト: `10`
  - 無制限にするには `Infinity` を指定

## リスクとメリット

### メリット

✅ **シンプル**: ルールが単純で理解しやすい
✅ **理論的には勝てる**: いつか勝てば損失を全回収できる
✅ **短期的な利益**: 連敗しなければ安定して利益が出る

### リスク

⚠️ **指数関数的な賭け金増加**: 連敗が続くと賭け金が急激に膨らむ
```
1回目: 10
5回目: 160
10回目: 5,120
15回目: 163,840
```

⚠️ **資金制限**: 無限の資金が必要（現実的には不可能）
⚠️ **テーブルリミット**: カジノには賭け金の上限がある
⚠️ **大きなリスク**: 小さな利益のために大きな資金をリスクにさらす
⚠️ **破産リスク**: 長い連敗で資金が尽きる可能性

## 実装仕様

### 状態管理

```typescript
interface MartingaleState {
  baseUnit: number;           // 初期賭け金
  currentBet: number;         // 現在の賭け金
  currentStreak: number;      // 現在の連敗数
  maxBet: number;             // 最大賭け金
  maxLossStreak: number;      // 最大連敗数
  totalProfit: number;        // 累積損益
  sessionActive: boolean;     // セッション状態
  reachedLimit: boolean;      // 上限到達フラグ
}
```

### 動作

#### 初期化 (`martingale_init`)
```typescript
{
  baseUnit: 10,
  maxBet?: 10240,        // オプション
  maxLossStreak?: 10     // オプション
}
```

#### 勝敗記録 (`martingale_record`)

**勝った場合:**
- 収支: `+currentBet`
- 賭け金を `baseUnit` にリセット
- 連敗カウントを `0` にリセット

**負けた場合:**
- 収支: `-currentBet`
- 賭け金を2倍にする: `currentBet × 2`
- 連敗カウントを +1
- 上限チェック:
  - `currentBet > maxBet` の場合: セッション終了
  - `currentStreak >= maxLossStreak` の場合: セッション終了

#### 状態確認 (`martingale_status`)
現在の状態を返す

#### リセット (`martingale_reset`)
セッションを初期状態に戻す（設定はそのまま）

## 使用例

### 基本的な使用

```
マーチンゲール法で基本賭け金10でセッションを開始して
```

### 上限を設定して使用

```
マーチンゲール法で基本賭け金10、最大賭け金1000、最大連敗数7でセッションを開始して
```

### 勝敗記録

```
負けを記録して
勝ちを記録して
```

### 状態確認

```
マーチンゲール法の現在の状態を確認して
```

## 推奨事項

1. **必ず上限を設定する**: 資金とリスク許容度に応じて `maxBet` と `maxLossStreak` を設定
2. **小さな基本単位**: 全資金の1-2%程度にする
3. **ストップロス**: 一定の損失で必ず止める
4. **目標利益の設定**: 達成したら必ず止める
5. **記録を取る**: 長期的な成績を記録・分析する

## 注意事項

⚠️ **教育・研究目的**: このツールは学習用です
⚠️ **ギャンブルの危険性**: 実際の賭博は依存症のリスクがあります
⚠️ **確実な方法ではない**: どんな戦略も長期的には必ず勝てるわけではありません
⚠️ **数学的期待値**: カジノゲームは控除率により期待値がマイナスです

## 参考資料

- [マーチンゲール法 - Wikipedia](https://ja.wikipedia.org/wiki/マーチンゲール法)
- カジノ数学と確率論
- 資金管理とリスク管理の基礎
